{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#pandora-aperture","title":"Pandora Aperture","text":""},{"location":"#installation","title":"Installation","text":"<p>To install you can use</p> <pre><code>pip install pandoraaperture --upgrade\n</code></pre> <p>You should update your package often, as we frequently put out new versions with updated Current Best Estimates, and some limited new functionality. Check your version number using</p> <pre><code>import pandoraaperture as pa\npa.__version__\n</code></pre>"},{"location":"dispersedprf/","title":"<code>DispersedPRF</code> API Documentation","text":"<p>               Bases: <code>pandoraaperture.prf.PRF</code></p> <p>Special case where PRF is dispersed in a line</p> <p>Special PRF class for making Pixel Response Functions that is dispersed across pixels.</p> <p>Parameters:</p> Name Type Description Default <code>trace_row</code> <p>Row position within the spectral trace that corresponds to each element in the flux array. Units of pixels.</p> required <code>trace_column</code> <p>Column position within the spectral trace that corresponds to each element in the flux array. Units of pixels.</p> required <code>flux</code> <p>Array of the flux of the PRF as a function of position. Usually normalized such that the total flux is 1.</p> required <code>pixel_size</code> <p>True detector pixel size in dimensions of length/pixel</p> required <code>sub_pixel_size</code> <p>PSF file pixel size in dimensions of length/pixel</p> required <code>scale</code> <p>How much to scale the PRF by. Scale of 2 makes the PSF 2x broader. Default is 1.</p> <code>1</code> <code>imshape</code> <p>Tuple of the shape of the true image. If using ROIs, use the shape of the image that each ROI is cut out from. Use format (row, column).</p> <code>(400, 80)</code> <code>imcorner</code> <p>Tuple of the lower left corner of the image, i.e. it's origin. Use this to move the image around on the grid. If using a window mode, make sure to set this to the right corner. Use format (row, column).</p> <code>(0, 0)</code>"},{"location":"dispersedprf/#pandoraaperture.prf.DispersedPRF.evaluate","title":"<code>evaluate(location=None, normalize=True, gradients=False)</code>","text":"<p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>row_im</code> <code>ndarray</code> <p>1D Array of integer row values at which the PRF is evaluated.</p> <code>column_im</code> <code>ndarray</code> <p>1D Array of integer column values at which the PRF is evaluated.</p> <code>prf_im</code> <code>ndarray</code> <p>2D Array of PRF values.</p> <code>dprf_im</code> <code>ndarray</code> <p>2, 2D arrays of the gradient of the PRF values. Only returned if <code>gradients</code>=True.</p>"},{"location":"dispersedprf/#pandoraaperture.prf.DispersedPRF.from_file","title":"<code>from_file(file, pixel_resolution=0.25)</code>  <code>classmethod</code>","text":"<p>Load a PRF object from a file.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <p>Input file to use. Choose either a string path to the file or an <code>astropy.fits.HDUList</code> object</p> required <code>pixel_resolution</code> <p>The separation between different elements in the PRF model in pixels. For example 0.25 means there will be approximately 0.25 pixels between each element.</p> <code>0.25</code>"},{"location":"dispersedprf/#pandoraaperture.prf.DispersedPRF.from_reference","title":"<code>from_reference(name='nirda', pixel_resolution=0.25)</code>  <code>classmethod</code>","text":"<p>Load a PRF from <code>pandoraref</code>.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Name of detector, choose from VISDA or NIRDA.</p> <code>'nirda'</code> <code>pixel_resolution</code> <p>The separation between different elements in the PRF model in pixels. For example 0.25 means there will be approximately 0.25 pixels between each element.</p> <code>0.25</code>"},{"location":"dispersedprf/#pandoraaperture.prf.DispersedPRF.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the PRF. Use this functon to visually inspect the PRF.</p>"},{"location":"dispersedprf/#pandoraaperture.prf.DispersedPRF.to_sparse3d","title":"<code>to_sparse3d(location=None, normalize=True, gradients=False)</code>","text":"<p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>X</code> <code>Sparse3D</code> <p>Sparse3D object containing the PRF at a given location.</p> <code>dX0</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 0 at a given location. Only returned if <code>gradients</code>=True.</p> <code>dX1</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 1 at a given location. Only returned if <code>gradients</code>=True.</p>"},{"location":"dispersedskyscene/","title":"<code>DispersedSkyScene</code> API Documentation","text":"<p>               Bases: <code>pandoraaperture.scene.SkyScene</code></p> <p>Special version of a SkyScene that works with dispersed PRFs</p> <p>Parameters:</p> Name Type Description Default <code>prf</code> <code>PRF</code> <p>pandoraaperture PRF class.</p> required <code>wcs</code> <code>WCS</code> <p>astropy World Coordinate System</p> required <code>time</code> <code>Time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.738704&gt;</code> <code>user_cat</code> <code>DataFrame</code> <p>Optional catalog from the user. Use this to pass a catalog of objects expected in this data that are not part of the Gaia catalog. You must include all the columns specified in your config file under <code>catalog_columns</code>.</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.NIRDAflux","title":"<code>NIRDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the NIRDA. This can be updated with a reference product in the future...!</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.VDAflux","title":"<code>VDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the VDA. This can be updated with a reference product in the future...!</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.flux","title":"<code>flux</code>  <code>property</code>","text":"<p>Here we set the flux that is assumed to be the default for this object. For dispersed sky scenes it's NIRDA.</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.header_cards","title":"<code>header_cards</code>  <code>property</code>","text":"<p>Header cards that are necessary to show state of package.</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.wcs_cards","title":"<code>wcs_cards</code>  <code>property</code>","text":"<p>Returns the WCS header as cards.</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.A","title":"<code>A(delta_pos=None)</code>","text":"<p>Returns the design matrix of the SkyScene.</p> <p>Parameters:</p> Name Type Description Default <code>A</code> <p>Matrix containing the PRFs of all targets in the scene.</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.evaluate","title":"<code>evaluate(delta_pos=None)</code>","text":"<p>Returns a dense image of the SkyScene</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.from_pointing","title":"<code>from_pointing(ra, dec, theta, time=&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.739599&gt;)</code>  <code>classmethod</code>","text":"<p>Parameters:</p> Name Type Description Default <code>ra</code> <p>Right Ascention</p> required <code>dec</code> <p>Declination</p> required <code>theta</code> <p>Roll angle in degrees</p> required <code>time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.739599&gt;</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_all_apertures","title":"<code>get_all_apertures(delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for all targets.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_aperture","title":"<code>get_aperture(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for a particular target.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_aperture_hdu","title":"<code>get_aperture_hdu(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the aperture, with aperture metrics in header.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_catalog_hdu","title":"<code>get_catalog_hdu(delta_pos=None)</code>","text":"<p>Obtain the catalog HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the catalog of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_model_hdu","title":"<code>get_model_hdu(delta_pos=None)</code>","text":"<p>Obtain the model HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the model of all sources, including their brightness.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.get_prf_hdu","title":"<code>get_prf_hdu(delta_pos=None)</code>","text":"<p>Obtain the PRF HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the  of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"dispersedskyscene/#pandoraaperture.scene.DispersedSkyScene.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the SkyScene. Use this functon to visually inspect the SkyScene.</p>"},{"location":"prf-examples/","title":"Example Usage","text":"In\u00a0[2]: Copied! <pre>import pandoraaperture as pa\nimport matplotlib.pyplot as plt\n</pre> import pandoraaperture as pa import matplotlib.pyplot as plt In\u00a0[3]: Copied! <pre>prf = pa.PRF.from_reference('visda')\n</pre> prf = pa.PRF.from_reference('visda') <p>The <code>prf</code> object above has loaded in the reference data from <code>pandoraref</code>. <code>pandoraaperture</code> should give you the best <code>pandoraref</code> to work with. Make sure to keep <code>pandoraaperture</code> up to date!</p> <p><code>PRF</code> classes can be plotted:</p> In\u00a0[14]: Copied! <pre>prf.plot();\n</pre> prf.plot(); <p>and evaluated</p> In\u00a0[15]: Copied! <pre>row, column, flux = prf.evaluate()\n</pre> row, column, flux = prf.evaluate() In\u00a0[56]: Copied! <pre>flux\n</pre> flux Out[56]: <pre>array([[-3.03739623e-074,  6.66698229e-072,  2.72054069e-067, ...,\n        -1.29675227e-105,  8.14490753e-110,  0.00000000e+000],\n       [ 2.42991699e-073, -7.91644162e-072, -6.05157045e-065, ...,\n        -2.57012630e-104, -2.33474179e-107,  0.00000000e+000],\n       [-1.03351689e-066, -2.90905254e-065,  4.34847067e-047, ...,\n        -7.07537406e-098,  1.68148491e-089,  0.00000000e+000],\n       ...,\n       [-3.73884790e-084,  4.37140533e-083, -1.91776041e-077, ...,\n        -6.97989831e-072, -1.57524301e-076,  0.00000000e+000],\n       [-1.34990905e-088, -4.05574822e-086,  3.05953083e-068, ...,\n        -1.71385091e-076,  2.02864600e-066,  0.00000000e+000],\n       [ 0.00000000e+000,  0.00000000e+000,  0.00000000e+000, ...,\n         0.00000000e+000,  0.00000000e+000,  0.00000000e+000]])</pre> <p>You can also get the gradient of the PRF.</p> In\u00a0[40]: Copied! <pre>row, column, flux, dflux = prf.evaluate(gradients=True)\n</pre> row, column, flux, dflux = prf.evaluate(gradients=True) <p>The first dimension of the dflux array corresponds to the gradient taken in the x or y direction.</p> In\u00a0[23]: Copied! <pre>dflux.shape\n</pre> dflux.shape Out[23]: <pre>(2, 32, 32)</pre> In\u00a0[50]: Copied! <pre>fig, ax = plt.subplots(1,2, figsize=[10,6])\nax[0].pcolormesh(column, row, dflux[0])\nax[1].pcolormesh(column, row, dflux[1])\nax[0].set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Gradient in x')\nax[1].set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Gradient in y');\n</pre> fig, ax = plt.subplots(1,2, figsize=[10,6]) ax[0].pcolormesh(column, row, dflux[0]) ax[1].pcolormesh(column, row, dflux[1]) ax[0].set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Gradient in x') ax[1].set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Gradient in y');  <p>PRFs have two key words which show where they should be evaluated on the detector</p> <p><code>imcorner</code> is the tuple of the lower left corner of the image. We see here this is set to (0, 0), for the visible detector this is the corner.</p> In\u00a0[24]: Copied! <pre>prf.imcorner\n</pre> prf.imcorner Out[24]: <pre>(0, 0)</pre> <p>There is also <code>imshape</code> which sets the shape of the detector.</p> In\u00a0[9]: Copied! <pre>prf.imshape\n</pre> prf.imshape Out[9]: <pre>(2048, 2048)</pre> <p><code>imcorner</code> and <code>imshape</code> set where the PRF is evaluated. So, if we want to change where the PRF is evaluated we should keep these tuples in mind.</p> <p>The default for evaluation is the middle of the detector.</p> In\u00a0[51]: Copied! <pre>row, column, flux = prf.evaluate()\n\nfig, ax = plt.subplots()\nax.pcolormesh(column, row, flux)\nax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model');\n</pre> row, column, flux = prf.evaluate()  fig, ax = plt.subplots() ax.pcolormesh(column, row, flux) ax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model'); <p>But you can change where you evaluate by updating the location. The location keyword is in (row, col) format and specifies the center of where the PRF will fall.</p> In\u00a0[26]: Copied! <pre>row, column, flux = prf.evaluate(location=(400, 1500))\n\nfig, ax = plt.subplots()\nax.pcolormesh(column, row, flux)\nax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model');\n</pre> row, column, flux = prf.evaluate(location=(400, 1500))  fig, ax = plt.subplots() ax.pcolormesh(column, row, flux) ax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model'); <p>Changing the location hasn't changed the shape of the PRF, because it is a simple PRF.</p> <p>Usisng the <code>SpatialPRF</code> class will let us use PRFs whose shape is spatially dependent on where it falls on the detector.</p> In\u00a0[27]: Copied! <pre>prf = pa.SpatialPRF.from_reference('visda')\n</pre> prf = pa.SpatialPRF.from_reference('visda') In\u00a0[28]: Copied! <pre>row, column, flux = prf.evaluate(location=(400, 1500))\n\nfig, ax = plt.subplots()\nax.pcolormesh(column, row, flux)\nax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model');\n</pre> row, column, flux = prf.evaluate(location=(400, 1500))  fig, ax = plt.subplots() ax.pcolormesh(column, row, flux) ax.set(aspect='equal', xlabel='Column', ylabel='Row', title='PRF Model'); <p>Now the PRF has changed significantly because we are far from the center.</p> <p>We can also use a <code>DispersedPRF</code> to work with the spectra on the NIRDA.</p> In\u00a0[59]: Copied! <pre>prf = pa.DispersedPRF.from_reference(\"nirda\")\n</pre> prf = pa.DispersedPRF.from_reference(\"nirda\") In\u00a0[60]: Copied! <pre>prf.plot();\n</pre> prf.plot(); <p>When we evaluate this kind of PRF it is slightly different</p> In\u00a0[61]: Copied! <pre>row, column, flux = prf.evaluate()\n</pre> row, column, flux = prf.evaluate() In\u00a0[62]: Copied! <pre>flux.shape\n</pre> flux.shape Out[62]: <pre>(836, 42, 42)</pre> <p>Now the flux, row, and column are 3D. These represent the PRFs along the trace.</p> In\u00a0[69]: Copied! <pre>fig, ax = plt.subplots()\nax.pcolormesh(column[0], row[0], flux[0])\nax.set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Model at {(prf.trace_row[0].value, prf.trace_column[0].value)}');\n</pre> fig, ax = plt.subplots() ax.pcolormesh(column[0], row[0], flux[0]) ax.set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Model at {(prf.trace_row[0].value, prf.trace_column[0].value)}'); <p>Note that the <code>imcorner</code> and <code>imshape</code> for the <code>DispersedPRF</code> are different. Their new values give the default corner and shape of the science array.</p> In\u00a0[33]: Copied! <pre>prf.imcorner\n</pre> prf.imcorner Out[33]: <pre>(824, 1968)</pre> In\u00a0[34]: Copied! <pre>prf.imshape\n</pre> prf.imshape Out[34]: <pre>(400, 80)</pre> <p>You can update these to change the array if needed.</p> In\u00a0[35]: Copied! <pre>prf.imshape = (512, 512)\nprf.plot();\n</pre> prf.imshape = (512, 512) prf.plot(); <p>You can convert all <code>PRF</code> objects to <code>Sparse3D</code> objects.</p> In\u00a0[54]: Copied! <pre>prf = pa.SpatialPRF.from_reference('visda')\n</pre> prf = pa.SpatialPRF.from_reference('visda') In\u00a0[26]: Copied! <pre>X = prf.to_sparse3d(location=(1058.340985, 1012.450385))\nX\n</pre> X = prf.to_sparse3d(location=(1058.340985, 1012.450385)) X Out[26]: <pre>&lt;(2048, 2048, 1) Sparse3D array of type float64&gt;</pre> <p>These objects embed the PRF at the correct position and have the full extent of the image. They are sparse, so they don't take up a lot of memory.</p> <p>You can perform matrix operations on <code>Sparse3D</code> objects, but you can't plot them directly. To do so, you need to first dot them with 1 to convert them to a dense array.</p> In\u00a0[35]: Copied! <pre>fig, ax = plt.subplots()\nax.imshow(X.dot(1), vmin=0, vmax=0.001, origin='lower')\nax.set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Model');\n</pre> fig, ax = plt.subplots() ax.imshow(X.dot(1), vmin=0, vmax=0.001, origin='lower') ax.set(aspect='equal', xlabel='Column', ylabel='Row', title=f'PRF Model'); <p>PRFs are designed to work with the shape of a single target. To work with a field containing many objects, use the <code>SkyScene</code> class which is demonstrated in <code>scene-examples.ipynb</code>.</p>"},{"location":"prf-examples/#example-usage","title":"Example Usage\u00b6","text":"<p>The PRF is the pixel response function. This is used to define where flux from a star will fall. The PRF reference product is given in <code>pandora-ref</code>. This package enables you to use those files to make a <code>PRF</code> object.</p> <p>There are three kinds of <code>PRF</code>s currently implemented:</p> <ul> <li><code>PRF</code> this base class has a simple PRF</li> <li><code>SpatialPRF</code> this class enables the PRF shape to vary as a function of position on the detector</li> <li><code>DispersedPRF</code> this class enables the PRF to be distributed along a trace.</li> </ul> <p>Let's make some PRFs so you can see how to use them.</p>"},{"location":"prf/","title":"<code>PRF</code> API Documentation","text":"<p>Pixel Response Function class</p> <p>PRF class for making Pixel Response Functions.</p> <p>Parameters:</p> Name Type Description Default <code>flux</code> <p>Array of the flux of the PRF as a function of position. Usually normalized such that the total flux is 1.</p> required <code>pixel_size</code> <p>True detector pixel size in dimensions of length/pixel</p> required <code>sub_pixel_size</code> <p>PSF file pixel size in dimensions of length/pixel</p> required <code>scale</code> <p>How much to scale the PRF by. Scale of 2 makes the PSF 2x broader. Default is 1.</p> <code>1</code> <code>imshape</code> <p>Tuple of the shape of the true image. If using ROIs, use the shape of the image that each ROI is cut out from. Use format (row, column).</p> <code>(2048, 2048)</code> <code>imcorner</code> <p>Tuple of the lower left corner of the image, i.e. it's origin. Use this to move the image around on the grid. If using a window mode, make sure to set this to the right corner. Use format (row, column).</p> <code>(0, 0)</code>"},{"location":"prf/#pandoraaperture.prf.PRF.evaluate","title":"<code>evaluate(location=None, normalize=True, gradients=False)</code>","text":"<p>Evaluate the PRF model for a target at a given location on the detector.</p> <p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>row_im</code> <code>ndarray</code> <p>1D Array of integer row values at which the PRF is evaluated.</p> <code>column_im</code> <code>ndarray</code> <p>1D Array of integer column values at which the PRF is evaluated.</p> <code>prf_im</code> <code>ndarray</code> <p>2D Array of PRF values.</p> <code>dprf_im</code> <code>ndarray</code> <p>2, 2D arrays of the gradient of the PRF values. Only returned if <code>gradients</code>=True.</p>"},{"location":"prf/#pandoraaperture.prf.PRF.from_file","title":"<code>from_file(file)</code>  <code>classmethod</code>","text":"<p>Load a PRF object from a file.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <p>Input file to use. Choose either a string path to the file or an <code>astropy.fits.HDUList</code> object</p> required"},{"location":"prf/#pandoraaperture.prf.PRF.from_reference","title":"<code>from_reference(name='visda')</code>  <code>classmethod</code>","text":"<p>Load a PRF from <code>pandoraref</code>.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Name of detector, choose from VISDA or NIRDA.</p> <code>'visda'</code>"},{"location":"prf/#pandoraaperture.prf.PRF.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the PRF. Use this functon to visually inspect the PRF.</p>"},{"location":"prf/#pandoraaperture.prf.PRF.to_sparse3d","title":"<code>to_sparse3d(location=None, normalize=True, gradients=False)</code>","text":"<p>Converts this <code>PRF</code> object to a <code>Sparse3D</code> object.</p> <p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>X</code> <code>Sparse3D</code> <p>Sparse3D object containing the PRF at a given location.</p> <code>dX0</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 0 at a given location. Only returned if <code>gradients</code>=True.</p> <code>dX1</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 1 at a given location. Only returned if <code>gradients</code>=True.</p>"},{"location":"roiskyscene/","title":"<code>ROISkyScene</code> API Documentation","text":"<p>               Bases: <code>pandoraaperture.scene.SkyScene</code></p> <p>Special version of a SkyScene that works with a ROI sparse matrix</p> <p>Parameters:</p> Name Type Description Default <code>prf</code> <code>PRF</code> <p>pandoraaperture PRF class.</p> required <code>wcs</code> <code>WCS</code> <p>astropy World Coordinate System</p> required <code>time</code> <code>Time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.738704&gt;</code> <code>user_cat</code> <code>DataFrame</code> <p>Optional catalog from the user. Use this to pass a catalog of objects expected in this data that are not part of the Gaia catalog. You must include all the columns specified in your config file under <code>catalog_columns</code>.</p> <code>None</code> <code>nROIs</code> <code>int</code> <p>The number of regions of interest in the larger image</p> <code>1</code> <code>ROI_size</code> <code>Tuple</code> <p>The size the regions of interest in (row, column) pixels. All ROIs must be the same size.</p> <code>(50, 50)</code> <code>ROI_corners</code> <code>List[Tuple[int, int]]</code> <p>The origin (lower left) corner positon for each of the ROIs. Must have length nROIs. List of tuples.</p> <code>(999, 999)</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.NIRDAflux","title":"<code>NIRDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the NIRDA. This can be updated with a reference product in the future...!</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.ROI_corners","title":"<code>ROI_corners = (999, 999)</code>  <code>class</code>","text":"<p>Built-in immutable sequence.</p> <p>If no argument is given, the constructor returns an empty tuple. If iterable is specified the tuple is initialized from iterable's items.</p> <p>If the argument is a tuple, the return value is the same object.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.ROI_size","title":"<code>ROI_size = (50, 50)</code>  <code>class</code>","text":"<p>Built-in immutable sequence.</p> <p>If no argument is given, the constructor returns an empty tuple. If iterable is specified the tuple is initialized from iterable's items.</p> <p>If the argument is a tuple, the return value is the same object.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.VDAflux","title":"<code>VDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the VDA. This can be updated with a reference product in the future...!</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.flux","title":"<code>flux</code>  <code>property</code>","text":"<p>Here we set the flux that is assumed to be the default for this object. For regular sky scenes it's VDA.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.header_cards","title":"<code>header_cards</code>  <code>property</code>","text":"<p>Header cards that are necessary to show state of package.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.nROIs","title":"<code>nROIs = 1</code>  <code>class</code>","text":"<p>int([x]) -&gt; integer int(x, base=10) -&gt; integer</p> <p>Convert a number or string to an integer, or return 0 if no arguments are given.  If x is a number, return x.int().  For floating point numbers, this truncates towards zero.</p> <p>If x is not a number or if base is given, then x must be a string, bytes, or bytearray instance representing an integer literal in the given base.  The literal can be preceded by '+' or '-' and be surrounded by whitespace.  The base defaults to 10.  Valid bases are 0 and 2-36. Base 0 means to interpret the base from the string as an integer literal.</p> <p>int('0b100', base=0) 4</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.wcs_cards","title":"<code>wcs_cards</code>  <code>property</code>","text":"<p>Returns the WCS header as cards.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.A","title":"<code>A(delta_pos=None)</code>","text":"<p>Returns the design matrix of the SkyScene.</p> <p>Parameters:</p> Name Type Description Default <code>A</code> <p>Matrix containing the PRFs of all targets in the scene.</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.evaluate","title":"<code>evaluate(delta_pos=None)</code>","text":"<p>Returns a dense image of the SkyScene</p> <pre><code>    Returns\n</code></pre> <pre><code>    r: npt.NDArray\n        Array of row positions of the image\n    c: npt.NDArray\n        Array of column positions of the image\n    im: npt.NDArray\n        Image of the scene\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.from_pointing","title":"<code>from_pointing(ra, dec, theta, nROIs, ROI_corners, ROI_size, time=&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.740103&gt;)</code>  <code>classmethod</code>","text":"<p>Parameters:</p> Name Type Description Default <code>ra</code> <p>Right Ascention</p> required <code>dec</code> <p>Declination</p> required <code>theta</code> <p>Roll angle in degrees</p> required <code>time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.740103&gt;</code> <code>nROIs</code> <p>The number of regions of interest in the larger image</p> required <code>ROI_corners</code> <p>The origin (lower left) corner positon for each of the ROIs. Must have length nROIs. List of tuples.</p> required <code>ROI_size</code> <p>The size the regions of interest in (row, column) pixels. All ROIs must be the same size.</p> required"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_all_apertures","title":"<code>get_all_apertures(delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for all targets.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_aperture","title":"<code>get_aperture(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for a particular target.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_aperture_hdu","title":"<code>get_aperture_hdu(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the aperture, with aperture metrics in header.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_catalog_hdu","title":"<code>get_catalog_hdu(delta_pos=None)</code>","text":"<p>Obtain the catalog HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the catalog of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_model_hdu","title":"<code>get_model_hdu(delta_pos=None)</code>","text":"<p>Obtain the model HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the model of all sources, including their brightness.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.get_prf_hdu","title":"<code>get_prf_hdu(delta_pos=None)</code>","text":"<p>Obtain the PRF HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the  of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"roiskyscene/#pandoraaperture.scene.ROISkyScene.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the SkyScene. Use this functon to visually inspect the SkyScene.</p>"},{"location":"scene-examples/","title":"Example Usage","text":"In\u00a0[22]: Copied! <pre>import pandoraaperture as pa\nimport matplotlib.pyplot as plt\nimport pandoraref as pr\nimport numpy as np\nfrom astropy.time import Time\n</pre> import pandoraaperture as pa import matplotlib.pyplot as plt import pandoraref as pr import numpy as np from astropy.time import Time In\u00a0[23]: Copied! <pre># coordinates for Kepler-10\nra, dec, theta = (285.6794224553767, 50.24130600481639, 85.1230985)\n</pre> # coordinates for Kepler-10 ra, dec, theta = (285.6794224553767, 50.24130600481639, 85.1230985) <p>The first kind of <code>SkyScene</code> is the base class and is mostly useful for modeling VISDA full frame images.</p> In\u00a0[24]: Copied! <pre>scene = pa.SkyScene.from_pointing(ra, dec, theta, time=Time.now())\n</pre> scene = pa.SkyScene.from_pointing(ra, dec, theta, time=Time.now()) In\u00a0[25]: Copied! <pre>scene\n</pre> scene Out[25]: <pre>SkyScene</pre> <p>Let's plot the scene. This models the scene using all the flux values in the catalog.</p> In\u00a0[26]: Copied! <pre>scene.plot();\n</pre> scene.plot(); <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:210: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  cat.phot_bp_mean_flux.fillna(0).values\n</pre> <p>This looks good, let's take a look at a different kind of SkyScene.</p> <p><code>ROISkyScene</code> is for ROIs on the VISDA. The ROIs are specified using their own corners and sizes.</p> In\u00a0[27]: Copied! <pre>rR, rC = np.mgrid[-500:500:3j, -500:500:3j]\n\nROI_corners = [(r + 1024 - 25, c + 1024 - 25) for r, c in zip(rR.ravel(), rC.ravel())]\nnROIs = len(ROI_corners)\nROI_size = (50, 50)\n</pre> rR, rC = np.mgrid[-500:500:3j, -500:500:3j]  ROI_corners = [(r + 1024 - 25, c + 1024 - 25) for r, c in zip(rR.ravel(), rC.ravel())] nROIs = len(ROI_corners) ROI_size = (50, 50) In\u00a0[28]: Copied! <pre>scene = pa.ROISkyScene.from_pointing(ra, dec, theta, time=Time.now(), nROIs=nROIs, ROI_size=ROI_size, ROI_corners=ROI_corners)\n</pre> scene = pa.ROISkyScene.from_pointing(ra, dec, theta, time=Time.now(), nROIs=nROIs, ROI_size=ROI_size, ROI_corners=ROI_corners) In\u00a0[29]: Copied! <pre>scene.plot(vmax=1000);\n</pre> scene.plot(vmax=1000); <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:210: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  cat.phot_bp_mean_flux.fillna(0).values\n</pre> <p>This looks good too.</p> <p>Let's look at the last kind of scene which is the <code>DispersedSkyScene</code>. This is primarily for working with NIRDA data.</p> In\u00a0[30]: Copied! <pre>scene = pa.DispersedSkyScene.from_pointing(ra, dec, theta, time=Time.now())\n</pre> scene = pa.DispersedSkyScene.from_pointing(ra, dec, theta, time=Time.now()) <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:219: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  return cat.j_flux.fillna(0).values * 1 * u.electron / u.second\n</pre> In\u00a0[31]: Copied! <pre>scene.plot(vmax=1000);\n</pre> scene.plot(vmax=1000); <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:219: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  return cat.j_flux.fillna(0).values * 1 * u.electron / u.second\n</pre> <p>All <code>SkyScene</code> objects use a PRF, WCS and a catalog of sources to make scenes. Each of these items should be loaded for you by the <code>SkyScene</code> object.</p> In\u00a0[32]: Copied! <pre>scene.prf\n</pre> scene.prf Out[32]: <pre>DispersedPRF [836 elements]</pre> In\u00a0[33]: Copied! <pre>scene.wcs\n</pre> scene.wcs Out[33]: <pre>WCS Keywords\n\nNumber of WCS axes: 2\nCTYPE : 'RA---TAN-SIP' 'DEC--TAN-SIP' \nCRVAL : 285.6794224553767 50.24130600481639 \nCRPIX : 2008.0 1024.0 \nPC1_1 PC1_2  : 0.08501524470486811 -0.9963796506190656 \nPC2_1 PC2_2  : 0.9963796506190656 0.08501524470486811 \nCDELT : -0.00033055555555555 0.00033055555555556 \nNAXIS : 0  0</pre> In\u00a0[34]: Copied! <pre>scene.cat\n</pre> scene.cat Out[34]: RA Dec source_id phot_g_mean_flux phot_bp_mean_flux phot_rp_mean_flux j_flux h_flux k_flux teff_gspphot row column 0 285.633757 50.231231 2132155154538128768 56236.210944 31355.100882 35614.164609 1540.991844 1572.679262 985.916266 5941.9517 932.076534 1984.175847 1 285.641148 50.233379 2132155085818652928 203377.545737 116295.538335 125442.543287 5250.496097 5448.0384 3137.90674 6142.2866 946.977434 1989.423785 2 285.647999 50.232175 2132155085818653184 42743.629051 17197.44932 36317.625121 2351.799751 3380.960991 2080.846441 4535.444 959.92687 1984.663413 3 285.679214 50.241604 2132155017099178624 807113.660182 430541.476911 539327.990865 24603.695303 27405.653344 16559.225946 5595.7837 1022.675063 2007.933868 4 285.742462 50.244746 2133655472513199360 44080.19357 24707.747994 27664.001865 1191.791655 1314.135538 776.676262 6050.1006 1144.778271 2007.053045 5 285.742767 50.260734 2133655571295536896 35732.399589 14461.998394 30473.324992 1927.526422 2763.377136 1794.072677 4520.6436 1149.299699 2055.215998 6 285.753612 50.237074 2133655403793722752 32228.636685 16795.400158 22203.38556 1128.756697 1296.104922 826.875325 5807.1235 1164.094135 1982.099503 7 285.764802 50.242807 2133655506872938752 3783886.782239 2558851.50372 1839476.5443 58748.981246 50008.077622 30105.097079 9376.287 1186.870348 1997.569689 8 285.786348 50.264355 2133655713031373184 119057.057927 67003.067235 74566.519233 3169.569944 3421.686056 1981.709686 6014.1904 1233.070374 2059.074925 9 285.815075 50.241934 2133655266354774528 47226.165502 25787.084681 30479.605866 1368.359904 1514.398462 890.922715 5815.2905 1281.980343 1986.80266 <p>The object works by creating a design matrix for you.</p> <p>This design matrix is a <code>Sparse3D</code> object which contains one image per source. When you dot it with the flux values of each source, you get the scene image.</p> In\u00a0[35]: Copied! <pre>scene.A(delta_pos=(0, 0))\n</pre> scene.A(delta_pos=(0, 0)) Out[35]: <pre>&lt;(400, 80, 10) Sparse3D array of type float64&gt;</pre> <p>Each <code>SkyScene</code> has an <code>evaluate</code> method which will return the image of the scene.</p> In\u00a0[36]: Copied! <pre>r, c, im = scene.evaluate()\n</pre> r, c, im = scene.evaluate() <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:219: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  return cat.j_flux.fillna(0).values * 1 * u.electron / u.second\n</pre> <p>You can move this scene around with the <code>delta_pos</code> argument to shift it by a number of pixels. You should only do this for small shifts.</p> <p><code>SkyScene</code> objects enable you to build FITS files containing the information you may need for that scene. You can obtain the following files</p> In\u00a0[37]: Copied! <pre>hdu = scene.get_catalog_hdu()\n</pre> hdu = scene.get_catalog_hdu() In\u00a0[38]: Copied! <pre>hdu.data\n</pre> hdu.data Out[38]: <pre>FITS_rec([(285.63375724, 50.23123125, '2132155154538128768',   56236.21094419,   31355.10088213,   35614.16460896,  1540.99184352,  1572.67926186,   985.91626641, 5941.9517,  932.07653438, 1984.17584713, 0, 0),\n          (285.64114848, 50.23337892, '2132155085818652928',  203377.54573736,  116295.53833483,  125442.5432872 ,  5250.49609725,  5448.03839999,  3137.90673989, 6142.2866,  946.97743365, 1989.42378521, 0, 0),\n          (285.64799859, 50.23217547, '2132155085818653184',   42743.62905105,   17197.44932034,   36317.625121  ,  2351.79975073,  3380.96099121,  2080.8464409 , 4535.444 ,  959.9268703 , 1984.66341253, 0, 0),\n          (285.67921404, 50.24160444, '2132155017099178624',  807113.66018202,  430541.47691061,  539327.99086458, 24603.69530318, 27405.6533437 , 16559.22594555, 5595.7837, 1022.67506268, 2007.93386828, 0, 0),\n          (285.74246182, 50.24474633, '2133655472513199360',   44080.1935701 ,   24707.74799427,   27664.00186461,  1191.79165461,  1314.13553792,   776.67626242, 6050.1006, 1144.77827079, 2007.05304495, 0, 0),\n          (285.74276729, 50.26073441, '2133655571295536896',   35732.39958896,   14461.99839408,   30473.32499193,  1927.52642221,  2763.37713634,  1794.0726765 , 4520.6436, 1149.29969872, 2055.21599811, 0, 0),\n          (285.75361156, 50.23707355, '2133655403793722752',   32228.63668549,   16795.40015799,   22203.38555981,  1128.75669692,  1296.10492239,   826.87532456, 5807.1235, 1164.09413491, 1982.09950322, 0, 0),\n          (285.76480193, 50.24280658, '2133655506872938752', 3783886.78223853, 2558851.50371957, 1839476.5442999 , 58748.9812463 , 50008.07762171, 30105.09707888, 9376.287 , 1186.87034804, 1997.56968904, 0, 0),\n          (285.78634785, 50.26435453, '2133655713031373184',  119057.05792735,   67003.06723471,   74566.51923251,  3169.56994443,  3421.68605625,  1981.70968561, 6014.1904, 1233.07037366, 2059.07492471, 0, 0),\n          (285.8150753 , 50.24193411, '2133655266354774528',   47226.16550153,   25787.08468124,   30479.60586578,  1368.35990431,  1514.39846237,   890.92271528, 5815.2905, 1281.98034252, 1986.80265976, 0, 0)],\n         dtype=(numpy.record, [('RA', '&lt;f8'), ('Dec', '&lt;f8'), ('source_id', 'S19'), ('phot_g_mean_flux', '&lt;f8'), ('phot_bp_mean_flux', '&lt;f8'), ('phot_rp_mean_flux', '&lt;f8'), ('j_flux', '&lt;f8'), ('h_flux', '&lt;f8'), ('k_flux', '&lt;f8'), ('teff_gspphot', '&lt;f8'), ('row', '&lt;f8'), ('column', '&lt;f8'), ('row0', '&lt;i8'), ('column0', '&lt;i8')]))</pre> In\u00a0[39]: Copied! <pre>scene.get_aperture_hdu(1)\n</pre> scene.get_aperture_hdu(1) <pre>/Users/chedges/Pandora/repos/pandora-aperture/src/pandoraaperture/scene.py:219: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n  return cat.j_flux.fillna(0).values * 1 * u.electron / u.second\n</pre> Out[39]: <pre>&lt;astropy.io.fits.hdu.compressed.compressed.CompImageHDU at 0x14f713af0&gt;</pre> In\u00a0[40]: Copied! <pre>from astropy.coordinates import SkyCoord\nscene.get_aperture_hdu(SkyCoord(ra, dec, unit='deg'))\n</pre> from astropy.coordinates import SkyCoord scene.get_aperture_hdu(SkyCoord(ra, dec, unit='deg')) Out[40]: <pre>&lt;astropy.io.fits.hdu.compressed.compressed.CompImageHDU at 0x16e943700&gt;</pre> In\u00a0[41]: Copied! <pre>scene.get_prf_hdu()\n</pre> scene.get_prf_hdu() Out[41]: <pre>&lt;astropy.io.fits.hdu.compressed.compressed.CompImageHDU at 0x16e94c5b0&gt;</pre> In\u00a0[42]: Copied! <pre>scene.get_model_hdu()\n</pre> scene.get_model_hdu() Out[42]: <pre>&lt;astropy.io.fits.hdu.compressed.compressed.CompImageHDU at 0x16e97dc40&gt;</pre> In\u00a0[\u00a0]: Copied! <pre>\n</pre> In\u00a0[\u00a0]: Copied! <pre>\n</pre>"},{"location":"scene-examples/#example-usage","title":"Example Usage\u00b6","text":"<p>The <code>SkyScene</code> object is designed to give you access to many PRFs to make up a field of stars. This will rely on you having <code>gaiaoffline</code> installed and the database for <code>gaiaoffline</code> downloaded and in the right place.</p> <p>!!! note \"You must ensure you have gaiaoffline database installed\"</p> <pre><code>You should follow the [`gaiaoffline` documentation](https://christinahedges.github.io/gaiaoffline/) to ensure your database is installed correctly. This database is 30gb, and you should download the approved one from Zenodo or obtain it from a team member.</code></pre> <p>To create a SkyScene we three things:</p> <ol> <li>The PRF: You should load the PRF you want to be used in the scene. You obtain the <code>PRF</code> from <code>pandoraaperture</code></li> <li>The WCS: The world coordinate system that we are using. This is determined by where we are pointing. You can obtain the WCS from <code>pandoraref</code></li> <li>The time: Because stars have proper motion we also need the time, to ensure the catalog has the stars in the right position. You should update the time based on when you're observing with Pandora.</li> </ol> <p>We have convenience methods to load PRFs and WCS using <code>from_pointing</code> which will take an RA, Dec, and theta for the boresight of the telescope and will then load the right reference products.</p>"},{"location":"scene-examples/#catalog-extension","title":"Catalog extension\u00b6","text":"<p>This extension shows what targets are likely to fall on a pixel</p>"},{"location":"scene-examples/#aperture-extension","title":"Aperture extension\u00b6","text":"<p>This extension shows the apertures for a given target. You will need to input the target number to obtain the aperture. You can either use the target index in the catalog, or a SkyCoord to use the target closest to that coordinate.</p>"},{"location":"scene-examples/#prf-extension","title":"PRF extension\u00b6","text":"<p>This extension gives you a FITS extension of the PRFs of each source. When combined with the catalog PRF, this gives you all of the information you strictly need for PRF photometry. This does not require a specific target to be input as it gives all PRFs for all possible targets.</p>"},{"location":"scene-examples/#model-extension","title":"Model extension\u00b6","text":"<p>This extension models the whole scene and returns it as an image.</p>"},{"location":"skyscene/","title":"<code>SkyScene</code> API Documentation","text":"<p>               Bases: <code>pandoraaperture.fits.FITSMixins</code></p> <p>Helper that takes astronomy catalogs and makes them a scene</p> <p>Parameters:</p> Name Type Description Default <code>prf</code> <code>PRF</code> <p>pandoraaperture PRF class.</p> required <code>wcs</code> <code>WCS</code> <p>astropy World Coordinate System</p> required <code>time</code> <code>Time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.738704&gt;</code> <code>user_cat</code> <code>DataFrame</code> <p>Optional catalog from the user. Use this to pass a catalog of objects expected in this data that are not part of the Gaia catalog. You must include all the columns specified in your config file under <code>catalog_columns</code>.</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.NIRDAflux","title":"<code>NIRDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the NIRDA. This can be updated with a reference product in the future...!</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.VDAflux","title":"<code>VDAflux</code>  <code>property</code>","text":"<p>Gives the flux on the VDA. This can be updated with a reference product in the future...!</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.flux","title":"<code>flux</code>  <code>property</code>","text":"<p>Here we set the flux that is assumed to be the default for this object. For regular sky scenes it's VDA.</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.header_cards","title":"<code>header_cards</code>  <code>property</code>","text":"<p>Header cards that are necessary to show state of package.</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.wcs_cards","title":"<code>wcs_cards</code>  <code>property</code>","text":"<p>Returns the WCS header as cards.</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.A","title":"<code>A(delta_pos=None)</code>","text":"<p>Returns the design matrix of the SkyScene.</p> <p>Parameters:</p> Name Type Description Default <code>A</code> <p>Matrix containing the PRFs of all targets in the scene.</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.evaluate","title":"<code>evaluate(delta_pos=None)</code>","text":"<p>Returns a dense image of the SkyScene</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.from_pointing","title":"<code>from_pointing(ra, dec, theta, time=&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.739060&gt;)</code>  <code>classmethod</code>","text":"<p>Parameters:</p> Name Type Description Default <code>ra</code> <p>Right Ascention</p> required <code>dec</code> <p>Declination</p> required <code>theta</code> <p>Roll angle in degrees</p> required <code>time</code> <p>astropy Time</p> <code>&lt;Time object: scale='utc' format='datetime' value=2026-01-05 20:14:03.739060&gt;</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_all_apertures","title":"<code>get_all_apertures(delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for all targets.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_aperture","title":"<code>get_aperture(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture and aperture statistics for a particular target.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code> <p>Returns:</p> Name Type Description <code>aperture</code> <code>ndarray</code> <p>Array of bools that shows which pixels are considered to be part of the target.</p> <code>contamination</code> <code>float</code> <p>Value showing how much of the flux in the aperture is due to other sources/the amount of flux inside the aperture.</p> <code>completeness</code> <code>float</code> <p>Value showing how much of the target flux is inside the aperture/total expected flux.</p> <code>total_in_aperture</code> <code>float</code> <p>Value showing how much flux is inside the aperture.</p>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_aperture_hdu","title":"<code>get_aperture_hdu(target, delta_pos=None, threshold=0.5)</code>","text":"<p>Obtain the aperture HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the aperture, with aperture metrics in header.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <p>Indicates a target in the catalog. Use either in integer to express an index in the catalog, or a SkyCoord to find the closest target</p> required <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code> <code>threshold</code> <p>Threshold to cut aperture off at, in units of electrons/s.</p> <code>0.5</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_catalog_hdu","title":"<code>get_catalog_hdu(delta_pos=None)</code>","text":"<p>Obtain the catalog HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the catalog of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_model_hdu","title":"<code>get_model_hdu(delta_pos=None)</code>","text":"<p>Obtain the model HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the model of all sources, including their brightness.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.get_prf_hdu","title":"<code>get_prf_hdu(delta_pos=None)</code>","text":"<p>Obtain the PRF HDU.</p> <p>Returns:</p> Name Type Description <code>hdu</code> <code>hdu</code> <p>FITS HDU containing the  of all sources that will land on pixels.</p> <p>Parameters:</p> Name Type Description Default <code>delta_pos</code> <p>Change in position in pixels. Use format (row, column).</p> <code>None</code>"},{"location":"skyscene/#pandoraaperture.scene.SkyScene.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the SkyScene. Use this functon to visually inspect the SkyScene.</p>"},{"location":"spatialprf/","title":"<code>SpatialPRF</code> API Documentation","text":"<p>               Bases: <code>pandoraaperture.prf.PRF</code></p> <p>Special case where the PRF is a function of focal plane position.</p> <p>Special PRF class for making Pixel Response Functions that change as a function of focal plane position.</p> <p>Parameters:</p> Name Type Description Default <code>focal_row</code> <p>Row position on the focal plane that corresponds to each element in the flux array. Units of pixels.</p> required <code>focal_column</code> <p>Column position on the focal plane that corresponds to each element in the flux array. Units of pixels.</p> required <code>flux</code> <p>Array of the flux of the PRF as a function of position. Usually normalized such that the total flux is 1.</p> required <code>pixel_size</code> <p>True detector pixel size in dimensions of length/pixel</p> required <code>sub_pixel_size</code> <p>PSF file pixel size in dimensions of length/pixel</p> required <code>scale</code> <p>How much to scale the PRF by. Scale of 2 makes the PSF 2x broader. Default is 1.</p> <code>1</code> <code>imshape</code> <p>Tuple of the shape of the true image. If using ROIs, use the shape of the image that each ROI is cut out from. Use format (row, column).</p> <code>(2048, 2048)</code> <code>imcorner</code> <p>Tuple of the lower left corner of the image, i.e. it's origin. Use this to move the image around on the grid. If using a window mode, make sure to set this to the right corner. Use format (row, column).</p> <code>(0, 0)</code>"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.evaluate","title":"<code>evaluate(location=None, normalize=True, gradients=False)</code>","text":"<p>Evaluate the PRF model for a target at a given location on the detector.</p> <p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>row_im</code> <code>ndarray</code> <p>1D Array of integer row values at which the PRF is evaluated.</p> <code>column_im</code> <code>ndarray</code> <p>1D Array of integer column values at which the PRF is evaluated.</p> <code>prf_im</code> <code>ndarray</code> <p>2D Array of PRF values.</p> <code>dprf_im</code> <code>ndarray</code> <p>2, 2D arrays of the gradient of the PRF values. Only returned if <code>gradients</code>=True.</p>"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.from_file","title":"<code>from_file(file)</code>  <code>classmethod</code>","text":"<p>Load a PRF object from a file.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <p>Input file to use. Choose either a string path to the file or an <code>astropy.fits.HDUList</code> object</p> required"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.from_reference","title":"<code>from_reference(name='visda')</code>  <code>classmethod</code>","text":"<p>Load a PRF from <code>pandoraref</code>.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Name of detector, choose from VISDA or NIRDA.</p> <code>'visda'</code>"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.plot","title":"<code>plot(**kwargs)</code>","text":"<p>Plots the PRF. Use this functon to visually inspect the PRF.</p>"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.to_PRF","title":"<code>to_PRF(location=None)</code>","text":"<p>Converts a spatial PRF into a PRF evaluated at a single location, making it faster to compute multiple PRFs, if necessary.</p> <p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code>"},{"location":"spatialprf/#pandoraaperture.prf.SpatialPRF.to_sparse3d","title":"<code>to_sparse3d(location=None, normalize=True, gradients=False)</code>","text":"<p>Converts this <code>PRF</code> object to a <code>Sparse3D</code> object.</p> <p>Parameters:</p> Name Type Description Default <code>location</code> <p>Location of the source on the detector. Use format (row, column). If not set will default to <code>self._default_location</code> which is in the middle of the image as set by <code>imshape</code> and <code>imcorner</code>.</p> <code>None</code> <code>normalize</code> <p>Whether to normalize the input data so that the total flux is 1.</p> <code>True</code> <code>gradients</code> <p>Whether to return gradients. If True, will return an additional 2 arrays that contain the gradients in each axis.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>X</code> <code>Sparse3D</code> <p>Sparse3D object containing the PRF at a given location.</p> <code>dX0</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 0 at a given location. Only returned if <code>gradients</code>=True.</p> <code>dX1</code> <code>Sparse3D</code> <p>Sparse3D object containing the gradient of the PRF in axis 1 at a given location. Only returned if <code>gradients</code>=True.</p>"}]}